dir:
  fields:
    id:
      type: MetaInteger
    path:
      type: MetaString
      size: 32
  keys:
    primary:
      fields: [id]
      autoIncrement: 1
  relations:
    files:
      table: file
      clauses: [id: dir_id]
      type: 1-N
      onDelete: CASCADE
file:
  fields:
    id:
      type: MetaInteger
    dir_id:
      type: MetaInteger
    name:
      type: MetaString
      size: 32
    path:
      type: MetaVirtual
      dependencies: [dir.path]
      handle: |
        function(\system\model\Recordset $file) {
          return $file->dir->path . $file->name;
        }
    extension:
      type: MetaVirtual
      dependencies: [name]
      handle: |
        function(\system\model\Recordset $file) {
          return \system\File::getExtension($file->name);
        }
  keys:
    primary:
      fields: [id]
      autoIncrement: 1
  relations:
    dir:
      table: dir
      clauses: [dir_id: id]
      type: N-1
image:
  fields:
    id:
      type: MetaInteger
    file1_id:
      type: MetaInteger
    width1:
      type: MetaInteger
    height1:
      type: MetaInteger
    file2_id:
      type: MetaInteger
    width2:
      type: MetaInteger
    height2:
      type: MetaInteger
    file3_id:
      type: MetaInteger
    width3:
      type: MetaInteger
    height3:
      type: MetaInteger
    file4_id:
      type: MetaInteger
    width4:
      type: MetaInteger
    height4:
      type: MetaInteger
  keys:
    primary:
      fields: [id]
      autoIncrement: 1
  relations:
    file1:
      table: file
      clauses: [file1_id: id]
      type: N-1
    file2:
      table: file
      clauses: [file2_id: id]
      type: N-1
    file3:
      table: file
      clauses: [file3_id: id]
      type: N-1
    file4:
      table: file
      clauses: [file4_id: id]
      type: N-1
comment:
  fields:
    id:
      type: MetaInteger
    content_id:
      type: MetaInteger
    comment_id:
      type: MetaInteger
    title:
      type: MetaString
      size: 80
    approved:
      type: MetaBoolean
  keys:
    primary:
      fields: [id]
      autoincrement: 1
  relations:
    content:
      table: content
      type: N-1
      clauses: [content_id: id]
      join: LEFT
    comment:
      table: comment
      type: N-1
      clauses: [comment_id: id]
      join: LEFT
term:
  fields:
    id:
      type: MetaInteger
    parent_id:
      type: MetaInteger
    ldel:
      type: MetaInteger
    rdel:
      type: MetaInteger
    value:
      type: MetaString
      size: 64
  keys:
    primary:
      fields: [id]
      autoIncrement: 1
  relations:
    parent:
      table: term
      type: N-1
      clauses: [parent_id: id]
    children:
      table: term
      type: 1-N
      clauses: [id: parent_id]
      onDelete: CASCADE
    ancestors:
      table: term
      clauses: []
      type: 1-N
      filterHandle: \module\core\model\Callbacks::termAncestors
    descendants:
      table: term
      clauses: []
      type: 1-N
      filterHandle: \module\core\model\Callbacks::termDescendants
    nodes:
      table: node_term
      type: 1-N
      clauses: [id: term_id]
      onDelete: CASCADE
node_term:
  fields:
    node_id:
      type: MetaInteger
    term_id:
      type: MetaInteger
  keys:
    primary:
      fields: [node_id, term_id]
  relations:
    node:
      table: node
      type: N-1
      clauses: [node_id: id]
    term:
      table: term
      type: N-1
      clauses: [term_id: id]
node_text:
  fields:
    node_id:
      type: MetaInteger
    lang:
      type: MetaString
      size: 2
    urn:
      type: MetaString
      size: 32
    title:
      type: MetaString
      size: 64
    subtitle:
      type: MetaString
      size: 128
    preview:
      type: MetaString
      size: 256
    body:
      type: MetaString
  keys:
    primary_key:
      fields: [node_id, lang]
    urn_key:
      fields: [urn, lang]
  relations:
    node:
      type: N-1
      table: node
      clauses: [node_id: id]
node:
  fields:
    id:
      type: MetaInteger
    urn:
      type: MetaString
      size: 32
    record_mode_id:
      type: MetaInteger
    ldel:
      type: MetaInteger
    rdel:
      type: MetaInteger
    parent_id:
      type: MetaInteger
    type:
      type: MetaString
      size: 16
    subtype:
      type: MetaString
      size: 16
    sort_index:
      type: MetaInteger
    image_id:
      type: MetaInteger
    file_id:
      type: MetaInteger
    image1_url:
      type: MetaVirtual
      dependencies: [urn, image.file1.extension]
      handle: |
        function(\system\model\Recordset $recordset) {
          return \config\settings()->BASE_DIR . 'node/image/1/' . $recordset->urn . '.' . $recordset->image->file1->extension;
        }
    image2_url:
      type: MetaVirtual
      dependencies: [urn, image.file2.extension]
      handle: |
        function(\system\model\Recordset $recordset) {
          return \config\settings()->BASE_DIR . 'node/image/2/' . $recordset->urn . '.' . $recordset->image->file2->extension;
        }
    image3_url:
      type: MetaVirtual
      dependencies: [urn, image.file3.extension]
      handle: |
        function(\system\model\Recordset $recordset) {
          return \config\settings()->BASE_DIR . 'node/image/3/' . $recordset->urn . '.' . $recordset->image->file3->extension;
        }
    image4_url:
      type: MetaVirtual
      dependencies: [urn, image.file4.extension]
      handle: |
        function(\system\model\Recordset $recordset) {
          return \config\settings()->BASE_DIR . 'node/image/4/' . $recordset->urn . '.' . $recordset->image->file4->extension;
        }
    file_url:
      type: MetaVirtual
      dependencies: [urn, file.extension]
      handle: |
        function(\system\model\Recordset $recordset) {
          return \config\settings()->BASE_DIR . 'node/file/' . $recordset->urn . '.' . $recordset->file->extension;
        }
    url:
      type: MetaVirtual
      dependencies: [urn, type]
      handle: |
        function(\system\model\Recordset $recordset) {
          switch ($recordset->type) {
            case 'page':
              return \config\settings()->BASE_DIR . $recordset->urn . '.html';
              break;
            default:
              return \config\settings()->BASE_DIR . $recordset->type . '/' . $recordset->urn . '.html';
          }
        }
#    edit_url:
#      type: MetaVirtual
#      dependencies: [urn, type]
#      handle: |
#        function(\system\model\Recordset $recordset) {
#          switch ($recordset->type) {
#            default:
#              return \config\settings()->BASE_DIR . $recordset->type . '/edit/' . $recordset->urn;
#          }
#        }
#    delete_url:
#      type: MetaVirtual
#      dependencies: [urn, type]
#      handle: |
#        function(\system\model\Recordset $recordset) {
#          switch ($recordset->type) {
#            default:
#              return \config\settings()->BASE_DIR . $recordset->type . '/delete/' . $recordset->urn;
#          }
#        }
  keys:
    primary_key:
      fields: [id]
    urn_key:
      fields: [urn]
  relations:
    record_mode:
      table: record_mode
      type: 1-1
      clauses: [record_mode_id: id]
    parent:
      table: node
      type: N-1
      clauses: [parent_id: id]
    children:
      table: node
      type: 1-N
      clauses: [id: parent_id]
      onDelete: CASCADE
    ancestors:
      table: node
      clauses: []
      type: 1-N
      filterHandle: \module\core\model\Callbacks::termAncestors
    descendants:
      table: node
      clauses: []
      type: 1-N
      filterHandle: \module\core\model\Callbacks::termDescendants
    terms:
      table: node_term
      type: 1-N
      clauses: [id: node_id]
      onDelete: CASCADE
    texts:
      table: node_text
      type: 1-N
      clauses: [id: node_id]
      onDelete: CASCADE
    text_default:
      table: node_text
      type: 1-1
      clauses: [id: node_id]
      filterHandle: |
        function(\system\model\RecordsetBuilder $node, \system\model\RecordsetBuilder $text) {
          $text->addFilter(new \system\model\FilterClause(
            $text->lang, '=', \config\settings()->DEFAULT_LANG
          ));
        }
    text:
      table: node_text
      type: 1-1
      clauses: [id: node_id]
      filterHandle: |
        function(\system\model\RecordsetBuilder $node, \system\model\RecordsetBuilder $text) {
          $text->addFilter(new \system\model\FilterClause(
            $text->lang, '=', \system\Lang::getLang()
          ));
        }
    text_en:
      table: node_text
      type: 1-1
      clauses: [id: node_id]
      filterHandle: |
        function(\system\model\RecordsetBuilder $node, \system\model\RecordsetBuilder $text) {
          $text->addFilter(new \system\model\FilterClause(
            $text->lang, '=', 'en'
          ));
        }
    text_it:
      table: node_text
      type: 1-1
      clauses: [id: node_id]
      filterHandle: |
        function(\system\model\RecordsetBuilder $node, \system\model\RecordsetBuilder $text) {
          $text->addFilter(new \system\model\FilterClause(
            $text->lang, '=', 'it'
          ));
        }
    text_de:
      table: node_text
      type: 1-1
      clauses: [id: node_id]
      filterHandle: |
        function(\system\model\RecordsetBuilder $node, \system\model\RecordsetBuilder $text) {
          $text->addFilter(new \system\model\FilterClause(
            $text->lang, '=', 'de'
          ));
        }
    file:
      table: file
      type: 1-1
      clauses: [file_id: id]
      onDelete: CASCADE
    image:
      table: image
      type: 1-1
      clauses: [image_id: id]
      onDelete: CASCADE

    page_header:
      table: node
      type: 1-1
      clauses: [id: parent_id]
      filterHandle: |
        function(\system\model\RecordsetBuilder $parent, \system\model\RecordsetBuilder $child) {
          $child->addFilter(new \system\model\FilterClause(
            $child->type, '=', 'page-header'
          ));
        }
    page_footer:
      table: node
      type: 1-1
      clauses: [id: parent_id]
      filterHandle: |
        function(\system\model\RecordsetBuilder $parent, \system\model\RecordsetBuilder $child) {
          $child->addFilter(new \system\model\FilterClause(
            $child->type, '=', 'page-footer'
          ));
        }
    page_banners:
      table: node
      type: 1-N
      clauses: [id: parent_id]
      filterHandle: |
        function(\system\model\Recordset $parent, \system\model\RecordsetBuilder $child) {
          $child->addFilter(new \system\model\FilterClause(
            $child->type, '=', 'page-banner'
          ));
        }
    page_articles:
      table: node
      type: 1-N
      clauses: [id: parent_id]
      filterHandle: |
        function(\system\model\Recordset $parent, \system\model\RecordsetBuilder $child) {
          $child->addFilter(new \system\model\FilterClause(
            $child->type, '=', 'article'
          ));
        }
    article_attachements:
      table: node
      type: 1-N
      clauses: [id: parent_id]
      filterHandle: |
        function(\system\model\Recordset $parent, \system\model\RecordsetBuilder $child) {
          $child->addFilter(new \system\model\FilterClause(
            $child->type, '=', 'article-attachement'
          ));
        }
    article_mp3s:
      table: node
      type: 1-N
      clauses: [id: parent_id]
      filterHandle: |
        function(\system\model\Recordset $parent, \system\model\RecordsetBuilder $child) {
          $child->addFilter(new \system\model\FilterClause(
            $child->type, '=', 'article-mp3'
          ));
        }
    article_videos:
      table: node
      type: 1-N
      clauses: [id: parent_id]
      filterHandle: |
        function(\system\model\Recordset $parent, \system\model\RecordsetBuilder $child) {
          $child->addFilter(new \system\model\FilterClause(
            $child->type, '=', 'article-video'
          ));
        }